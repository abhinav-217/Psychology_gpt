<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>
    </head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        html {
            scroll-behavior: smooth;
        }
    </style>
    <body style="background: rgb(2,0,36);background: linear-gradient(90deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%);">
        <div class="container mt-5 d-flex justify-content-evenly">
            <button type="button" class="btn btn-primary" id="chat">Chat</button>
            <button type="button" class="btn btn-warning" id="say">Say</button>
        </div>
        <div class="text-center text-white" id="chat-center">
            <div class="container d-flex flex-column justify-content-evenly w-50 h-100">
                <form method="post" action="/generate">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="prompt-user" class="form-label">Enter Prompt:</label>
                        <input class="form-control" type="text" name="prompt" id="prompt-user" placeholder="Type your prompt here">
                    </div>
                    <button id="submit_btn" type="submit" name="btn" class="btn btn-warning mt-3">Get info</button>
                </form>
            </div>
        </div>
        <div class="text-center container d-none mt-3 w-50" id="audio-center">
            <button id="start" onclick="start_input()" type="button" class="btn btn-primary">Start Recording</button>
            <form class="mt-4" method="post" action="/generate">
                {% csrf_token %}
                <div class="mb-3">
                    <input class="form-control d-none" type="text" name="prompt" id="audio-prompt">
                </div>
                <p id="temp" class="text-white">Say Something</p>
                <p id="temp2" class="text-white d-none">Question here</p>
                <button id="audio_query" type="submit" name="btn" class="btn btn-warning mt-3">Get info</button>
            </form>
        </div>
        <div class="container text-center d-none" id="loader">
            <img src="../static/loader.gif" class = "w-25" alt="" srcset="">
        </div>
    </body>
    <script>
        let chat = document.getElementById('chat')
        let say = document.getElementById('say')
        let submit_btn = document.getElementById('submit_btn')
        let audio_query = document.getElementById('audio_query')
        submit_btn.addEventListener('click',()=>{
            document.getElementById('loader').classList.remove('d-none')
        })
        audio_query.addEventListener('click',()=>{
            document.getElementById('loader').classList.remove('d-none')
            audio_query.classList.add("d-none")
            let text = document.getElementById("temp").innerText;
            document.getElementById("temp2").innerText = "Question Asked is:- "+text
            document.getElementById("temp").classList.add('d-none')
            document.getElementById("temp2").classList.remove('d-none')
        })
        say.addEventListener('click',()=>{
            document.getElementById('chat-center').classList.remove('d-none')
            document.getElementById('chat-center').classList.add('d-none')
            document.getElementById('audio-center').classList.remove('d-none')
            document.getElementById('say').classList.add('disable')
        })
        chat.addEventListener('click',()=>{
            document.getElementById('audio-center').classList.remove('d-none')
            document.getElementById('audio-center').classList.add('d-none')
            document.getElementById('chat-center').classList.remove('d-none')
            document.getElementById('chat').classList.add('disable')
        })
        function start_input() {
            var speech = true;
            window.SpeechRecognition =
                window.SpeechRecognition || window.webkitSpeechRecognition;

            const recognition = new SpeechRecognition();
            recognition.interimResults = true;
            var final_string = "";
            recognition.addEventListener("result", (e) => {
                const transcript = Array.from(e.results)
                .map((result) => result[0])
                .map((result) => result.transcript)
                .join("");
                document.getElementById("temp").innerText = transcript
                document.getElementById("audio-prompt").value = transcript
            });
            if (speech == true) {
                recognition.start();
                recognition.addEventListener("end", recognition.start);
            }
        }
        function change_input_value(string){
            console.log("Function called",string)
            document.getElementById("temp").innerHTML = string;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</html>
